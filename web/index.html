<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> tex-fmt </title>
</head>

<body>
  <h1> tex-fmt </h1>
  <h3> An extremely fast LaTex formatter </h3>

  <!-- Buttons -->
  <div>
    <button id="submitButton">Format</button>
    <button id="copyButton">Copy output to clipboard</button>
  </div>

  <!-- Input and output -->
  <div style="display: flex; gap: 20px;">

    <div style="flex: 1; display: flex; flex-direction: column; max-width: 600px;">
      <h3> Input </h3>
      <textarea id="textInput" rows="30" cols="80"></textarea>
    </div>

    <div style="flex: 1; display: flex; flex-direction: column; max-width: 600px;">
      <h3> Output </h3>
      <textarea id="textOutput" rows="30" cols="80" readonly></textarea>
    </div>

  </div>

  <!-- Config and logs -->
  <div style="display: flex; gap: 20px;">

    <div style="flex: 1; display: flex; flex-direction: column; max-width: 600px;">
      <h3> Config (optional) </h3>
      <textarea id="textConfig" rows="20" cols="80"></textarea>
    </div>

    <div style="flex: 1; display: flex; flex-direction: column; max-width: 600px;">
      <h3> Logs </h3>
      <textarea id="textLog" rows="20" cols="80" readonly></textarea>
    </div>

  </div>

  <!-- Main script -->
  <script type="module">

    // Import wasm
    import init, { main } from '../pkg/tex_fmt.js';

    // Initialize wasm
    (async () => {
      try {
        await init();
        console.log('WASM initialized successfully.');
      } catch (error) {
        console.error('Error initializing WASM :', error);
        alert('Failed to initialize WASM. Check console for details.');
      }
    })();

    // Submit button logic
    document.getElementById('submitButton').addEventListener(
      'click', async () => {
        const inputText = document.getElementById('textInput').value;
        const outputBox = document.getElementById('textOutput');
        const logBox = document.getElementById('textLog');
        try {
          const configText = document.getElementById('textConfig').value;
          const result = await main(inputText, configText);
          outputBox.value = result.output;
          logBox.value = result.logs;
        } catch (error) {
          console.error('Error calling WebAssembly function:', error);
          alert('An error occurred. Check the console for details.');
        }
      }
    );

  // Copy output text to clipboard
  document.getElementById('copyButton').addEventListener(
    'click', () => {
      const outputBox = document.getElementById('textOutput');
      outputBox.select();
      outputBox.setSelectionRange(0, 99999);
      try {
        document.execCommand('copy');
        alert('Copied to clipboard:\n\n' + outputBox.value);
      } catch (err) {
        console.error('Failed to copy text: ', err);
      }
    }
  );
  </script>

</body>
</html>
