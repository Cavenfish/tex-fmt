<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> tex-fmt </title>
</head>

<body>
  <h1> tex-fmt </h1>

  <!-- Buttons -->
  <div>
    <button id="submitButton">Submit</button>
    <button id="copyButton">Copy output</button>
  </div>

  <!-- Input and output -->
  <div>
    <textarea id="textInput" rows="40" cols="80"
      placeholder="Input text"></textarea>
    <textarea id="textOutput" rows="40" cols="80"
      placeholder="Output text" readonly></textarea>
  </div>

  <!-- Config -->
  <div>
    <textarea id="textConfig" rows="40" cols="80"
      placeholder="Config (optional)"># tabsize = 2</textarea>
  </div>

  <!-- Logs -->
  <div>
    Logs
  </div>
  <div>
    <textarea id="textLog" rows="20" cols="160"
      placeholder="Logs" readonly></textarea>
  </div>

  <!-- Main script -->
  <script type="module">

    // Import wasm
    import init, { main } from '../pkg/tex_fmt.js';

    // Initialize wasm
    (async () => {
      try {
        await init();
        console.log('WASM initialized successfully.');
      } catch (error) {
        console.error('Error initializing WASM :', error);
        alert('Failed to initialize WASM. Check console for details.');
      }
    })();

    // Submit button logic
    document.getElementById('submitButton').addEventListener(
      'click', async () => {
        const inputText = document.getElementById('textInput').value;
        const outputBox = document.getElementById('textOutput');
        const logBox = document.getElementById('textLog');
        try {
          const configText = document.getElementById('textConfig').value;
          const result = await main(inputText, configText);
          outputBox.value = result.output;
          logBox.value = result.logs;
        } catch (error) {
          console.error('Error calling WebAssembly function:', error);
          alert('An error occurred. Check the console for details.');
        }
      }
    );

  // Copy output text to clipboard
  document.getElementById('copyButton').addEventListener(
    'click', () => {
      const outputBox = document.getElementById('textOutput');
      outputBox.select();
      outputBox.setSelectionRange(0, 99999);
      try {
        document.execCommand('copy');
        alert('Copied to clipboard:\n\n' + outputBox.value);
      } catch (err) {
        console.error('Failed to copy text: ', err);
      }
    }
  );
  </script>

</body>
</html>
